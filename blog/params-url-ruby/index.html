<!DOCTYPE html><html lang=fr><head><meta charset=utf-8 /><meta content="width=device-width,initial-scale=1" name=viewport /><title>Récupérer Paramètres d'URL d'une Liste de Pages avec Ruby &bull; Antoine Brisset</title><meta content="Découvrez comment récupérer facilement les paramètres d'une liste d'URL. Un petit script Ruby Utile pour vos optimisations techniques SEO !" name=description /><meta content="index,follow" name=robots /><meta content=R7aPiADkUTnBNzbTvsqutfN3_gewIxUFwJpKYyc-hBQ name=google-site-verification /><link href="/apple-touch-icon.png" rel=apple-touch-icon sizes=57x57 /><link href="/apple-touch-icon-57x57-precomposed.png" rel=apple-touch-icon sizes=57x57 /><link href="/apple-touch-icon-60x60-precomposed.png" rel=apple-touch-icon sizes=60x60 /><link href="/apple-touch-icon-72x72-precomposed.png" rel=apple-touch-icon sizes=72x72 /><link href="/apple-touch-icon-76x76-precomposed.png" rel=apple-touch-icon sizes=76x76 /><link href="/apple-touch-icon-114x114-precomposed.png" rel=apple-touch-icon sizes=114x114 /><link href="/apple-touch-icon-120x120-precomposed.png" rel=apple-touch-icon sizes=120x120 /><link href="/apple-touch-icon-144x144-precomposed.png" rel=apple-touch-icon sizes=144x144 /><link href="/apple-touch-icon-152x152-precomposed.png" rel=apple-touch-icon sizes=152x152 /><link href="/favicon-196x196.png" rel=icon sizes=196x196 type="image/png"/><link href="/favicon-160x160.png" rel=icon sizes=160x160 type="image/png"/><link href="/favicon-96x96.png" rel=icon sizes=96x96 type="image/png"/><link href="/favicon-32x32.png" rel=icon sizes=32x32 type="image/png"/><link href="/favicon-16x16.png" rel=icon sizes=16x16 type="image/png"/><meta content="#f5f5f5" name=msapplication-TileColor /><meta content="/mstile-144x144.png" name=msapplication-TileImage /><link href="/stylesheets/application.css" rel=stylesheet /><link href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800" rel=stylesheet /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel=stylesheet /><style>.header{background-image: url('/images/backgrounds/small/code.jpeg');}
    @media screen and (min-width: 25em){.header{background-image: url('/images/backgrounds/medium/code.jpeg');}}
    @media screen and (min-width: 50em){.header{background-image: url('/images/backgrounds/code.jpeg');}}</style><script src="/javascripts/all.js"></script></head><body class="blog blog_params-url-ruby blog_params-url-ruby_index"> <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-WW7MSH" height=0 width=0 style="display:none;visibility:hidden"></iframe></noscript> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-NKG6T7');</script> <div class=wrapper><nav role=navigation><div class=fat-nav><div class=fat-nav__wrapper><ul><li><a href="/">Accueil</a></li><li><a href="/blog/">Blog SEO</a></li><li><a href="/#contact">Contact</a></li></ul></div></div></nav></div><div role=main></div><div class=header><div class=wrapper><h1 class=header__title>Récupérer les paramètres d'une liste d'URLs avec Ruby</h1><p class=header__category><i class="fa fa-tag"></i> <em>Scripts SEO</em></p></div></div><div class="section section__content--large"><div class=wrapper><article class=blog__article><p class=blog__breadcrumb><a href="/blog/">Blog SEO</a> / <a href="/blog/categories/scripts-seo/">Scripts SEO</a></p><p class=blog__date>Publié le 7 Jun 2018</p><p class=blog__chapo>Manipuler de longues listes de mots-clés ou de longues listes d'URL fait partie du quotidien d'un référenceur. Et quand on a des traitements récurrents à faire sur ces fichiers, on cherche souvent à automatiser. Un exemple ici avec l'extraction des paramètres depuis une liste d'URLs.</p><p>Vous avez une liste d&#39;URLs issue d&#39;un crawl, d&#39;une analyse de logs ou d&#39;un export de backlinks et vous cherchez à identifier rapidement quels sont les différents paramètres d&#39;URL présents ? Voici comment faire.</p> <h2>L&#39;intérêt SEO</h2> <p>Les applications sont nombreuses : identifier des paramètres générant du duplicate d&#39;URL, trier les paramètres à autoriser/interdire au crawl ou à l&#39;indexation, vérifier qu&#39;il n&#39;y a pas de problèmes de casse avec certains paramètres en minuscules et d&#39;autres en majuscule, etc.</p> <h2>La méthode en Ruby</h2> <p>Voilà un petit script pour automatiser le processus avec Ruby.</p> <h3>Récupérer les paramètres</h3> <p>Pour récupérer les différents paramètres à partir de la liste, on va boucler sur cette liste et découper l&#39;URL chaque fois qu&#39;on trouve un &ldquo;?&rdquo; ou un &ldquo;&amp;&rdquo;. Chaque valeur sera stockée dans un array. On va ensuite retirer de notre array le 1er élement (l&#39;URL sans les paramètres) via la méthode <code>drop</code>. Puis supprimer de l&#39;array les éléments vides, et, pour chaque valeur, supprimer tout ce qui se trouve derrière le &ldquo;=&rdquo;. On va enfin mettre à plat notre array avec <code>flatten</code>.</p> <div class=highlight><pre class="highlight ruby"><code><span class="c1">#!/usr/bin/env ruby</span>

<span class="k">def</span> <span class="nf">get_params_from</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
  <span class="n">list</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">url</span><span class="o">|</span>
    <span class="n">url</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sr">/\?|\&amp;/</span><span class="p">).</span>
        <span class="nf">drop</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span>
        <span class="nf">reject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:empty?</span><span class="p">).</span>
        <span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">param</span><span class="o">|</span> <span class="n">param</span><span class="p">.</span><span class="nf">sub!</span><span class="p">(</span><span class="sr">/=.*/</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span><span class="p">.</span><span class="nf">flatten</span>
<span class="k">end</span>
</code></pre></div> <h3>Compter le nombre d&#39;occurrences de chaque paramètre</h3> <p>Une fois qu&#39;on a notre liste de paramètres, on va compter le nombre de fois où chaque paramètre apparait. On va utiliser pour cela la méthode <code>inject</code> qui permet d&#39;instancier un mémo (ici un hash) qu&#39;on remplit lors de notre loop avec un simple comptage.</p> <div class=highlight><pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">count_params_from</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
  <span class="n">list</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span> <span class="o">|</span><span class="n">h</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">h</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div> <h3>Stocker le tout dans un CSV</h3> <p>Il ne reste plus qu&#39;à exporter le tout dans un CSV, en triant le fichier dans l&#39;ordre décroissant du nombre d&#39;occurences de chaque paramètre.</p> <div class=highlight><pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">export_to_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="no">CSV</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"params.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
    <span class="n">data</span><span class="p">.</span><span class="nf">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="n">v</span> <span class="p">}.</span><span class="nf">reverse</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span>
      <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> <p>On aura donc en sortie un fichier CSV avec deux colonnes, la première contenant le paramètre et la deuxième le nombre d&#39;occurences.</p> <h3>Le code complet</h3> <p>Votre liste d&#39;URLs de départ doit se trouver dans un fichier &ldquo;urls.csv&rdquo;. Amusez-vous bien :)</p> <div class=highlight><pre class="highlight ruby"><code><span class="c1">#!/usr/bin/env ruby</span>

<span class="nb">require</span> <span class="s1">'CSV'</span>

<span class="k">def</span> <span class="nf">get_params_from</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
  <span class="n">list</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">url</span><span class="o">|</span>
    <span class="n">url</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sr">/\?|\&amp;/</span><span class="p">).</span>
        <span class="nf">drop</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span>
        <span class="nf">reject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:empty?</span><span class="p">).</span>
        <span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">param</span><span class="o">|</span> <span class="n">param</span><span class="p">.</span><span class="nf">sub!</span><span class="p">(</span><span class="sr">/=.*/</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span><span class="p">.</span><span class="nf">flatten</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">count_params_from</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
  <span class="n">list</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span> <span class="o">|</span><span class="n">h</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">h</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">export_to_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="no">CSV</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"params.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
    <span class="n">data</span><span class="p">.</span><span class="nf">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="n">v</span> <span class="p">}.</span><span class="nf">reverse</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span>
      <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">list</span> <span class="o">=</span> <span class="no">CSV</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"./urls.csv"</span><span class="p">).</span><span class="nf">flatten</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">get_params_from</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="n">params_hash_count</span> <span class="o">=</span> <span class="n">count_params_from</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">export_to_csv</span><span class="p">(</span><span class="n">params_hash_count</span><span class="p">)</span>
</code></pre></div><div id=disqus_thread></div> <script>
//<![CDATA[
                  var disqus_shortname = 'blogantoinebrisset';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script> <noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript> <a href='http://disqus.com' class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a> </article></div></div><footer class=footer><div role=content-info><ul class=footer__content><li class=footer__content__item><i class="fa fa-home"></i> Marquette-lez-Lille</li><li class=footer__content__item><i class="fa fa-phone"></i> 06 12 71 82 78</li><li class=footer__content__item><i class="fa fa-envelope"></i> <a href="#email-protection-pbagnpg@nagbvar-oevffrg.pbz">contact@antoine-brisset.com</a> </li></ul><ul class=footer__content--social><li class=footer__content__item--social><a href="https://twitter.com/abrisset"><i class='fa fa-twitter footer__icon'></i></a></li><li class=footer__content__item--social><a href="https://github.com/ABrisset"><i class='fa fa-github footer__icon'></i></a></li><li class=footer__content__item--social><a href="http://plus.google.com/112811217796192792405?rel=author"><i class='fa fa-google-plus footer__icon'></i></a></li></ul><div class=footer__copyright> &copy; 2019 - <a href="/">Antoine Brisset</a></div></div></footer><script type="text/javascript">!function(){try{var a,b,c,d,g=document.getElementsByTagName("a");for(c=0;g.length-c;c++)try{b=g[c].getAttribute("href"),b&&b.indexOf("#email-protection-")>-1&&b.length>19&&(a="",d=19+b.indexOf("#email-protection-"),b.length>d&&(a=b.substr(18).replace(/[a-zA-Z]/g,function(a){return String.fromCharCode(("Z">=a?90:122)>=(a=a.charCodeAt(0)+13)?a:a-26)})),g[c].setAttribute("href","mailto:"+a))}catch(h){}}catch(h){}}();</script>
</body></html>