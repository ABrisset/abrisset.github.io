<!DOCTYPE html><html lang=fr><head><meta charset=utf-8 /><meta content="width=device-width,initial-scale=1" name=viewport /><title>Couper une chaîne de caractères avec Ruby (truncate) &bull; Antoine Brisset</title><meta content="Vous avez besoin de tronquer une chaine de caractères sans couper un mot en plein milieu ? Voici une méthode qui va vous faire gagner du temps" name=description /><meta content="index,follow" name=robots /><meta content=R7aPiADkUTnBNzbTvsqutfN3_gewIxUFwJpKYyc-hBQ name=google-site-verification /><link href="/apple-touch-icon.png" rel=apple-touch-icon sizes=57x57 /><link href="/apple-touch-icon-57x57-precomposed.png" rel=apple-touch-icon sizes=57x57 /><link href="/apple-touch-icon-60x60-precomposed.png" rel=apple-touch-icon sizes=60x60 /><link href="/apple-touch-icon-72x72-precomposed.png" rel=apple-touch-icon sizes=72x72 /><link href="/apple-touch-icon-76x76-precomposed.png" rel=apple-touch-icon sizes=76x76 /><link href="/apple-touch-icon-114x114-precomposed.png" rel=apple-touch-icon sizes=114x114 /><link href="/apple-touch-icon-120x120-precomposed.png" rel=apple-touch-icon sizes=120x120 /><link href="/apple-touch-icon-144x144-precomposed.png" rel=apple-touch-icon sizes=144x144 /><link href="/apple-touch-icon-152x152-precomposed.png" rel=apple-touch-icon sizes=152x152 /><link href="/favicon-196x196.png" rel=icon sizes=196x196 type="image/png"/><link href="/favicon-160x160.png" rel=icon sizes=160x160 type="image/png"/><link href="/favicon-96x96.png" rel=icon sizes=96x96 type="image/png"/><link href="/favicon-32x32.png" rel=icon sizes=32x32 type="image/png"/><link href="/favicon-16x16.png" rel=icon sizes=16x16 type="image/png"/><meta content="#f5f5f5" name=msapplication-TileColor /><meta content="/mstile-144x144.png" name=msapplication-TileImage /><link href="/stylesheets/application.css" rel=stylesheet /><link href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800" rel=stylesheet /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel=stylesheet /><style>.header{background-image: url('/images/backgrounds/small/code.jpeg');}
    @media screen and (min-width: 25em){.header{background-image: url('/images/backgrounds/medium/code.jpeg');}}
    @media screen and (min-width: 50em){.header{background-image: url('/images/backgrounds/code.jpeg');}}</style><script src="/javascripts/all.js"></script></head><body class="blog blog_truncate-ruby blog_truncate-ruby_index"> <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-WW7MSH" height=0 width=0 style="display:none;visibility:hidden"></iframe></noscript> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-NKG6T7');</script> <div class=wrapper><nav role=navigation><div class=fat-nav><div class=fat-nav__wrapper><ul><li><a href="/">Accueil</a></li><li><a href="/blog/">Blog SEO</a></li><li><a href="/#contact">Contact</a></li></ul></div></div></nav></div><div role=main></div><div class=header><div class=wrapper><h1 class=header__title>Tronquer un contenu avec Ruby</h1><p class=header__category><i class="fa fa-tag"></i> <em>Scripts SEO</em></p></div></div><div class="section section__content--large"><div class=wrapper><article class=blog__article><p class=blog__breadcrumb><a href="/blog/">Blog SEO</a> / <a href="/blog/categories/scripts-seo/">Scripts SEO</a></p><p class=blog__date>Publié le 1 Sep 2017</p><p class=blog__chapo>Tronquer un contenu textuel est un besoin récurrent, que ce soit sur un blog ou sur un site e-commerce : extrait d'un article, description courte d'un produit, etc. Souvent, cette manipulation est nécessaire pour éviter le contenu dupliqué. Je vous propose ici un petit helper qui vous fera gagner du temps si le site est développé avec Ruby.</p><p>À noter que Ruby on Rails propose un helper pour cette opération, mais tous les projets Ruby ne sont pas forcément codés avec RoR :)</p> <p>L&#39;objectif est de tronquer un contenu texte, sans couper un mot en plein milieu. Car oui, on pourrait tronquer à partir de x caractères, sans se soucier de l&#39;endroit où ça tombe, mais ce serait beaucoup moins élégant&hellip;</p> <p>Notre méthode reçoit 2 arguments : une chaine de caractères, ici la variable <code>text</code>, et une longueur définie, ici 160 caractères.</p> <div class=highlight><pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">160</span><span class="p">)</span>
  <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">split</span>
  <span class="n">susp</span>  <span class="o">=</span> <span class="s2">"..."</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">words</span><span class="p">.</span><span class="nf">inject</span><span class="p">([])</span> <span class="k">do</span> <span class="o">|</span><span class="n">memo</span><span class="p">,</span> <span class="n">word</span><span class="o">|</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">memo</span> <span class="o">+</span> <span class="p">[</span><span class="n">word</span><span class="p">]).</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">).</span><span class="nf">length</span> <span class="o">&lt;</span> <span class="n">length</span>
      <span class="n">memo</span> <span class="o">&lt;&lt;</span> <span class="n">word</span>
    <span class="k">else</span>
      <span class="n">memo</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="nf">last</span> <span class="o">=~</span> <span class="sr">/[[:punct:]]/</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">pop</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">).</span><span class="nf">concat</span><span class="p">(</span><span class="n">susp</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">).</span><span class="nf">concat</span><span class="p">(</span><span class="n">susp</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> <p>La 1ère opération consiste à éclater notre chaine de caractères et à stocker chaque sous-chaine dans un tableau, ici <code>words</code>.</p> <p>Nous bouclons sur <code>words</code>, en utilisant la méthode <code>inject</code>. Similaire à <code>reduce</code>, cette méthode permet, lorsqu&#39;un lui passe un bloc en paramètre, d&#39;incrémenter un &ldquo;mémo&rdquo; à chaque itération. Le mémo est ici sous la forme d&#39;un tableau vide ([]). Tant que la longueur du mémo + la longueur du mot (espace compris) est inférieure au nombre de caractères choisi (160 caractères par défaut), on stocke dans notre mémo la valeur de <code>word</code>. Si la longueur du mémo est supérieure à 160 caractères, on arrête d&#39;incrémenter le mémo.</p> <p>Pour améliorer l&#39;expérience utilisateur (cf commentaire de Xavier), on ajoute des points de suspension à notre chaine de caractères. Pour cela, on vérifie d&#39;abord que le dernier élément du tableau correspond à un signe de ponctuation. Si c&#39;est le cas, on supprime cet élément via la méthode <code>pop</code>. Puis on reforme une chaine de caractères complète à l&#39;aide de <code>join</code>. La méthode <code>join</code> permet de convertir chaque élément d&#39;un tableau en chaines de caractères, séparées par le caractère de notre choix, ici un espace. Enfin, on concatène les points de suspension à la chaine de caractères retournée, via la méthode <code>concat</code>.</p> <p>Et voilà, vous disposez maintenant d&#39;un helper pour tronquer vos contenus et éviter le duplicate content interne !</p> <div id=disqus_thread></div> <script>
//<![CDATA[
                  var disqus_shortname = 'blogantoinebrisset';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script> <noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript> <a href='http://disqus.com' class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a> </article></div></div><footer class=footer><div role=content-info><ul class=footer__content><li class=footer__content__item><i class="fa fa-home"></i> Marquette-lez-Lille</li><li class=footer__content__item><i class="fa fa-phone"></i> 06 12 71 82 78</li><li class=footer__content__item><i class="fa fa-envelope"></i> <a href="#email-protection-pbagnpg@nagbvar-oevffrg.pbz">contact@antoine-brisset.com</a> </li></ul><ul class=footer__content--social><li class=footer__content__item--social><a href="https://twitter.com/abrisset"><i class='fa fa-twitter footer__icon'></i></a></li><li class=footer__content__item--social><a href="https://github.com/ABrisset"><i class='fa fa-github footer__icon'></i></a></li><li class=footer__content__item--social><a href="http://plus.google.com/112811217796192792405?rel=author"><i class='fa fa-google-plus footer__icon'></i></a></li></ul><div class=footer__copyright> &copy; 2019 - <a href="/">Antoine Brisset</a></div></div></footer><script type="text/javascript">!function(){try{var a,b,c,d,g=document.getElementsByTagName("a");for(c=0;g.length-c;c++)try{b=g[c].getAttribute("href"),b&&b.indexOf("#email-protection-")>-1&&b.length>19&&(a="",d=19+b.indexOf("#email-protection-"),b.length>d&&(a=b.substr(18).replace(/[a-zA-Z]/g,function(a){return String.fromCharCode(("Z">=a?90:122)>=(a=a.charCodeAt(0)+13)?a:a-26)})),g[c].setAttribute("href","mailto:"+a))}catch(h){}}catch(h){}}();</script>
</body></html>