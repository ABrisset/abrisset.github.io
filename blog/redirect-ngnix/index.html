<!DOCTYPE html><html lang=fr><head><meta charset=utf-8 /><meta content="width=device-width,initial-scale=1" name=viewport /><title>Redirections Nginx (301) &bull; Antoine Brisset</title><meta content="Vous débutez sur Nginx ? Voici un panorama des principales directives à mettre en place pour effectuer vos redirections serveur." name=description /><meta content="index,follow" name=robots /><meta content=R7aPiADkUTnBNzbTvsqutfN3_gewIxUFwJpKYyc-hBQ name=google-site-verification /><link href="/apple-touch-icon.png" rel=apple-touch-icon sizes=57x57 /><link href="/apple-touch-icon-57x57-precomposed.png" rel=apple-touch-icon sizes=57x57 /><link href="/apple-touch-icon-60x60-precomposed.png" rel=apple-touch-icon sizes=60x60 /><link href="/apple-touch-icon-72x72-precomposed.png" rel=apple-touch-icon sizes=72x72 /><link href="/apple-touch-icon-76x76-precomposed.png" rel=apple-touch-icon sizes=76x76 /><link href="/apple-touch-icon-114x114-precomposed.png" rel=apple-touch-icon sizes=114x114 /><link href="/apple-touch-icon-120x120-precomposed.png" rel=apple-touch-icon sizes=120x120 /><link href="/apple-touch-icon-144x144-precomposed.png" rel=apple-touch-icon sizes=144x144 /><link href="/apple-touch-icon-152x152-precomposed.png" rel=apple-touch-icon sizes=152x152 /><link href="/favicon-196x196.png" rel=icon sizes=196x196 type="image/png"/><link href="/favicon-160x160.png" rel=icon sizes=160x160 type="image/png"/><link href="/favicon-96x96.png" rel=icon sizes=96x96 type="image/png"/><link href="/favicon-32x32.png" rel=icon sizes=32x32 type="image/png"/><link href="/favicon-16x16.png" rel=icon sizes=16x16 type="image/png"/><meta content="#f5f5f5" name=msapplication-TileColor /><meta content="/mstile-144x144.png" name=msapplication-TileImage /><link href="/stylesheets/application.css" rel=stylesheet /><link href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800" rel=stylesheet /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel=stylesheet /><style>.header{background-image: url('/images/backgrounds/small/server.jpg');}
    @media screen and (min-width: 25em){.header{background-image: url('/images/backgrounds/medium/server.jpg');}}
    @media screen and (min-width: 50em){.header{background-image: url('/images/backgrounds/server.jpg');}}</style><script src="/javascripts/all.js"></script></head><body class="blog blog_redirect-ngnix blog_redirect-ngnix_index"> <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-WW7MSH" height=0 width=0 style="display:none;visibility:hidden"></iframe></noscript> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-NKG6T7');</script> <div class=wrapper><nav role=navigation><div class=fat-nav><div class=fat-nav__wrapper><ul><li><a href="/">Accueil</a></li><li><a href="/blog/">Blog SEO</a></li><li><a href="/#contact">Contact</a></li></ul></div></div></nav></div><div role=main></div><div class=header><div class=wrapper><h1 class=header__title>Comment Effectuer Une Redirection Nginx ?</h1><p class=header__category><i class="fa fa-tag"></i> <em>Administration Serveur</em></p></div></div><div class="section section__content--large"><div class=wrapper><article class=blog__article><p class=blog__breadcrumb><a href="/blog/">Blog SEO</a> / <a href="/blog/categories/administration-serveur/">Administration Serveur</a></p><p class=blog__date>Publié le 21 Mar 2013</p><p class=blog__chapo>Dans le petit monde des serveurs HTTP, Nginx est encore peu répandu, en comparaison de son cousin Apache. Néanmoins, cette techno d'origine russe est très intéressante d'un point de vue performances. Les plus gros sites l'ont d'ailleurs adopté : GitHub et Wordpress tournent ainsi sous 'engine-X'...</p><p>Dans ce 1er article, il ne sera pas question de perf&rsquo; mais de redirections. Rediriger correctement les pages de son site est en effet vital aussi bien d&#39;un point de vue SEO que d&#39;un point de vue UX, par exemple en situation de refonte.</p> <p>La grande différence avec Apache, c&#39;est qu&#39;avec Nginx vous n&#39;avez pas accès à un fichier de type .htaccess. Toutes les directives doivent être directement implémentées au niveau du fichier de configuration serveur, auquel vous pouvez avoir accès en règle générale via ce chemin <em>_etc/nginx/nginx.conf</em>. Si vous avez créé plusieurs virtual hosts, en revanche, les modifications seront à effectuer ici <em>_/etc/nginx/sites-available/votre-domaine.com</em>. A noter que l&#39;équivalent Nginx de mod_rewrite (Apache) est HTTP rewrite module.</p> <p>Passons maintenant à la pratique.</p> <h2>Redirection basique : page à page</h2> <p>Pour effectuer une redirection d&#39;une page vers une autre, voici comment il faut procéder dans la conf&rsquo; Nginx.</p> <div class=highlight><pre class="highlight nginx"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="s">www.votre-domaine.com</span><span class="p">;</span>
  <span class="kn">rewrite</span>  <span class="s">^/votre-page.html</span>$  <span class="s">http://www.votre-domaine.com/nouvelle-page.html</span> <span class="s">permanent</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <p>A noter que si vous utilisez le flag &ldquo;permanent&rdquo;, la redirection sera de type 301, alors que si vous utilisez &ldquo;redirect&rdquo;, celle-ci sera de type 302 (temporaire).</p> <h2>Redirection d&#39;un set d&#39;URLs</h2> <p>Bien entendu, il est possible de faire usage des expressions régulières, par exemple pour rediriger tout un groupe d&#39;URLs partageant une syntaxe commune.</p> <div class=highlight><pre class="highlight nginx"><code><span class="k">rewrite</span> <span class="s">^/dossier/pages-id-.*.html</span>$ <span class="s">http://www.votre-domaine.com/nouveau-dossier/pages-</span><span class="nv">$1</span><span class="s">.html</span> <span class="s">permanent</span><span class="p">;</span>
</code></pre></div> <h2>Redirection d&#39;une URL avec paramètres vers une URL sans paramètres</h2> <p>Dans le cas d&#39;une URL avec paramètres, que vous souhaiteriez rediriger vers une nouvelle URL débarrassée de ces paramètres, voici la bonne manière de faire. Ici, le paramètre est par exemple ?page.</p> <div class=highlight><pre class="highlight nginx"><code><span class="k">location</span> <span class="p">~</span> <span class="sr">/ancienne-page.php</span> <span class="p">{</span>
  <span class="kn">if</span> <span class="s">(</span><span class="nv">$args</span> <span class="p">~</span> <span class="sr">page=100)</span><span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^</span> <span class="s">http://www.votre-domaine.com/nouvelle-page.html?</span> <span class="s">permanent</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <p>C&#39;est le point d&#39;interrogation qui donne l&#39;instruction à Nginx de ne pas ajouter les éventuels paramètres derrière l&#39;URL. &ldquo;args&rdquo; permet de définir les paramètres à matcher. Location permet de définir le pattern d&#39;URLs concernés par le rewrite. Le tilde introduit une regexp (case sensitive).</p> <h2>Redirection d&#39;une URL si un paramètre existe</h2> <p>Si vous voulez rediriger tout un set d&#39;URLs contenant un paramètre, peu importe la valeur, vers une URL sans paramètre voici la syntaxe à adopter avec ici un paramètre ?page par exemple</p> <div class=highlight><pre class="highlight nginx"><code><span class="k">location</span> <span class="p">~</span> <span class="sr">/ancienne-page.php</span> <span class="p">{</span>
  <span class="kn">if</span> <span class="s">(</span><span class="nv">$arg_page</span> <span class="s">!=</span> <span class="s">"")</span><span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^ http://www.votre-domaine.com/nouvelle-page.html?</span> <span class="s">permanent</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <p>Si vous voulez faire la même chose mais en conservant les paramètres dans l&#39;URL de destination, voici comment procéder. Dans l&#39;exemple ci-dessous, on redirige les urls contenant le paramètre page vers une url où la valeur de ce paramètre est passée dans le slug.</p> <div class=highlight><pre class="highlight nginx"><code><span class="k">location</span> <span class="p">~</span> <span class="sr">/ancienne-page.php</span> <span class="p">{</span>
  <span class="kn">if</span> <span class="s">(</span><span class="nv">$arg_page</span> <span class="s">!=</span> <span class="s">"")</span><span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^</span> <span class="s">http://www.votre-domaine.com/nouvelle-page/</span><span class="nv">$arg_page</span><span class="s">?</span> <span class="s">permanent</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <h2>Redirection vers le sous-domaine www</h2> <p>Si vous souhaitez que toutes les requêtes sur votre-domaine.com soient redirigées vers www.votre_domaine.com, voici le code à utiliser.</p> <div class=highlight><pre class="highlight nginx"><code><span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="s">votre-domaine.com</span><span class="p">;</span>
  <span class="kn">rewrite</span> <span class="s">^/(.*)</span> <span class="s">http://www.votre_domaine.com/</span><span class="nv">$1</span> <span class="s">permanent</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <h2>Redirection ou code serveur spécifique en fonction du user-agent</h2> <p>Vous pouvez également avoir besoin d&#39;effectuer une action spécifique en fonction du user agent qui se présente. Par exemple, envoyer un forbidden sur une page que Googlebot ou Bingbot ne doivent pas crawler, comme une page de login wordpress.</p> <div class=highlight><pre class="highlight nginx"><code><span class="k">location</span> <span class="p">~</span> <span class="sr">(wp-admin|wp-login\.php)</span> <span class="p">{</span>
  <span class="kn">if</span> <span class="s">(</span><span class="nv">$http_user_agent</span> <span class="p">~</span><span class="sr">*</span> <span class="s">"(bingbot|googlebot)")</span> <span class="p">{</span>
    <span class="kn">return</span> <span class="mi">403</span><span class="p">;</span>
    <span class="kn">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <p>Ici on target les pages wp-login.php et wp-admin. On vérifie si l&#39;user-agent demandant la page est Googlebot ou Bingbot. Si c&#39;est le cas, on envoie un code d&#39;erreur 403. L&#39;utilisation du tilde + étoile permet de rendre la regexp case insensitive. Attention ! L&#39;utilisation de &ldquo;break&rdquo; indique que le serveur ne doit appliquer les directives qu&#39;à l&#39;intérieur du bloc défini par &ldquo;location&rdquo;. A l&#39;inverse avec &ldquo;last&rdquo;, le serveur recherche une URI qui pourrait matcher avec le pattern dans tous les blocs &ldquo;location&rdquo; et applique le process défini s&#39;il en trouve une.</p> <h2>Bonus : définir une page à renvoyer en fonction d&#39;un code serveur</h2> <p>Avec Nginx, vous pouvez  également définir quelle url doit être appelée en fonction d&#39;un header http spécifique. Voici un exemple avec le code d&#39;erreur 404.</p> <div class=highlight><pre class="highlight nginx"><code><span class="k">error_page</span> <span class="mi">404</span> <span class="n">/404.html</span><span class="p">;</span>
</code></pre></div> <p>Voilà donc quelques exemples de syntaxes à connaître pour gérer vos redirections. J&#39;aborderai la question de la perf dans un autre article ;)</p> <div id=disqus_thread></div> <script>
//<![CDATA[
                  var disqus_shortname = 'blogantoinebrisset';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script> <noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript> <a href='http://disqus.com' class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a> </article></div></div><footer class=footer><div role=content-info><ul class=footer__content><li class=footer__content__item><i class="fa fa-home"></i> Marquette-lez-Lille</li><li class=footer__content__item><i class="fa fa-phone"></i> 06 12 71 82 78</li><li class=footer__content__item><i class="fa fa-envelope"></i> <a href="#email-protection-pbagnpg@nagbvar-oevffrg.pbz">contact@antoine-brisset.com</a> </li></ul><ul class=footer__content--social><li class=footer__content__item--social><a href="https://twitter.com/abrisset"><i class='fa fa-twitter footer__icon'></i></a></li><li class=footer__content__item--social><a href="https://github.com/ABrisset"><i class='fa fa-github footer__icon'></i></a></li><li class=footer__content__item--social><a href="http://plus.google.com/112811217796192792405?rel=author"><i class='fa fa-google-plus footer__icon'></i></a></li></ul><div class=footer__copyright> &copy; 2019 - <a href="/">Antoine Brisset</a></div></div></footer><script type="text/javascript">!function(){try{var a,b,c,d,g=document.getElementsByTagName("a");for(c=0;g.length-c;c++)try{b=g[c].getAttribute("href"),b&&b.indexOf("#email-protection-")>-1&&b.length>19&&(a="",d=19+b.indexOf("#email-protection-"),b.length>d&&(a=b.substr(18).replace(/[a-zA-Z]/g,function(a){return String.fromCharCode(("Z">=a?90:122)>=(a=a.charCodeAt(0)+13)?a:a-26)})),g[c].setAttribute("href","mailto:"+a))}catch(h){}}catch(h){}}();</script>
</body></html>