<!DOCTYPE html><html lang=fr><head><meta charset=utf-8 /><meta content="width=device-width,initial-scale=1" name=viewport /><title>Scraping & Analyse de Balise Title avec R &bull; Antoine Brisset</title><meta content="Apprenez à scraper avec R et à calculer les fréquences de n-grams dans un corpus, en seulement quelques lignes de codes." name=description /><meta content="index,follow" name=robots /><meta content=R7aPiADkUTnBNzbTvsqutfN3_gewIxUFwJpKYyc-hBQ name=google-site-verification /><link href="/apple-touch-icon.png" rel=apple-touch-icon sizes=57x57 /><link href="/apple-touch-icon-57x57-precomposed.png" rel=apple-touch-icon sizes=57x57 /><link href="/apple-touch-icon-60x60-precomposed.png" rel=apple-touch-icon sizes=60x60 /><link href="/apple-touch-icon-72x72-precomposed.png" rel=apple-touch-icon sizes=72x72 /><link href="/apple-touch-icon-76x76-precomposed.png" rel=apple-touch-icon sizes=76x76 /><link href="/apple-touch-icon-114x114-precomposed.png" rel=apple-touch-icon sizes=114x114 /><link href="/apple-touch-icon-120x120-precomposed.png" rel=apple-touch-icon sizes=120x120 /><link href="/apple-touch-icon-144x144-precomposed.png" rel=apple-touch-icon sizes=144x144 /><link href="/apple-touch-icon-152x152-precomposed.png" rel=apple-touch-icon sizes=152x152 /><link href="/favicon-196x196.png" rel=icon sizes=196x196 type="image/png"/><link href="/favicon-160x160.png" rel=icon sizes=160x160 type="image/png"/><link href="/favicon-96x96.png" rel=icon sizes=96x96 type="image/png"/><link href="/favicon-32x32.png" rel=icon sizes=32x32 type="image/png"/><link href="/favicon-16x16.png" rel=icon sizes=16x16 type="image/png"/><meta content="#f5f5f5" name=msapplication-TileColor /><meta content="/mstile-144x144.png" name=msapplication-TileImage /><link href="/stylesheets/application.css" rel=stylesheet /><link href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800" rel=stylesheet /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel=stylesheet /><style>.header{background-image: url('/images/backgrounds/small/semantic.jpg');}
    @media screen and (min-width: 25em){.header{background-image: url('/images/backgrounds/medium/semantic.jpg');}}
    @media screen and (min-width: 50em){.header{background-image: url('/images/backgrounds/semantic.jpg');}}</style><script src="/javascripts/all.js"></script></head><body class="blog blog_title-ngrams-r blog_title-ngrams-r_index"> <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-WW7MSH" height=0 width=0 style="display:none;visibility:hidden"></iframe></noscript> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-NKG6T7');</script> <div class=wrapper><nav role=navigation><div class=fat-nav><div class=fat-nav__wrapper><ul><li><a href="/">Accueil</a></li><li><a href="/blog/">Blog SEO</a></li><li><a href="/#contact">Contact</a></li></ul></div></div></nav></div><div role=main></div><div class=header><div class=wrapper><h1 class=header__title>Analyser les title d'une requête avec R</h1><p class=header__category><i class="fa fa-tag"></i> <em>Sémantique</em></p></div></div><div class="section section__content--large"><div class=wrapper><article class=blog__article><p class=blog__breadcrumb><a href="/blog/">Blog SEO</a> / <a href="/blog/categories/semantique/">Sémantique</a></p><p class=blog__date>Publié le 26 May 2017</p><p class=blog__chapo>Le langage R a le vent en poupe dans la communauté SEO depuis quelques mois, voire quelques années. Après avoir lu les très bons articles de <a href='https://data-seo.fr/'>Vincent Terrasi</a> et de <a href='http://gameofseo.fr/'>Grégory Florin</a> sur le sujet, je me suis lancé il y a peu dans l'apprentissage de ce langage.</p><p>Les avantages de R, à mon sens, sont tout d&#39;abord le nombre de librairies existantes, notamment pour faire du TAL, mais aussi et surtout la possibilité de produire une visualisation directement depuis la console, en quelques lignes. La complexité, je trouve, est de bien comprendre la différence entre les vecteurs, les data frames, les listes, les tableaux&hellip; et de les utiliser à bon escient en fonction de l&#39;objectif.</p> <p>Pour ce premier article sur R, je vais vous montrer comment extraire les balises title des 10 premiers résultats de la SERP, puis analyser les n-grams contenus dans ces balises. Let&rsquo;s go !</p> <h2>Charger les librairies nécessaires</h2> <p>Commençons par charger les librairies dont nous aurons besoin :</p> <ul> <li>tm : pour les opérations de text mining</li> <li>corrplot : pour la visualisation de la matrice finale</li> <li>rJava : pour appeler du code Java depuis R</li> <li>rvest : pour le scraping</li> <li>RWeka : pour le calcul de n-grams</li> </ul> <div class=highlight><pre class="highlight r"><code><span class="n">library</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">corrplot</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rJava</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RWeka</span><span class="p">)</span><span class="w">
</span></code></pre></div> <p>Si elles ne sont pas installées sur votre machine, vous pouvez le faire via install.packages(&ldquo;nom_librairie&rdquo;).</p> <h2>Scraper les résultats Google</h2> <p>Pour scraper le contenu des pages HTML, j&#39;utilise la library rvest qui contient tout un ensemble de fonctions permettant d&#39;aller à l&#39;essentiel.</p> <p>Tout d&#39;abord, je récupère le code HTML de la page de résultats. Ici, j&#39;ai choisi la page de résultats Google pour la requête <em>consultant seo</em> :</p> <div class=highlight><pre class="highlight r"><code><span class="n">source</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_html</span><span class="p">(</span><span class="s2">"https://www.google.fr/search?q=consultant%20seo"</span><span class="p">)</span><span class="w">
</span></code></pre></div> <p>Via XPath, je récupère les liens et leurs contenus dans un vecteur :</p> <div class=highlight><pre class="highlight r"><code><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">xpath</span><span class="o">=</span><span class="s2">"//h3[@class='r']/a/@href"</span><span class="p">)</span><span class="w">
</span><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">html_text</span><span class="p">(</span><span class="n">links</span><span class="p">)</span><span class="w">
</span></code></pre></div> <p>Je nettoie le vecteur, pour ne garder que les URL. Pour cela, j&#39;utilise la fonction <code>sub</code> associée à une expression régulière :</p> <div class=highlight><pre class="highlight r"><code><span class="n">pattern</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"\\/url\\?q=(.*)&amp;sa.*"</span><span class="w">
</span><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="s1">'\\1'</span><span class="p">,</span><span class="w"> </span><span class="n">links</span><span class="p">,</span><span class="w"> </span><span class="n">perl</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grep</span><span class="p">(</span><span class="s2">"http"</span><span class="p">,</span><span class="w"> </span><span class="n">links</span><span class="p">,</span><span class="w"> </span><span class="n">fixed</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div> <h2>Extraire les balises title</h2> <p>Via la fonction <code>get_title</code>, je récupère la balise title de chaque page et la stocke dans une liste :</p> <div class=highlight><pre class="highlight r"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">
</span><span class="n">get_title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">html_text</span><span class="p">(</span><span class="n">html_nodes</span><span class="p">(</span><span class="n">read_html</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">xpath</span><span class="o">=</span><span class="s1">'//title'</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">output</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">links</span><span class="p">,</span><span class="w"> </span><span class="n">get_title</span><span class="p">)</span><span class="w">
</span></code></pre></div> <h2>Nettoyer les contenus</h2> <p>Passons maintenant à la phase de nettoyage des contenus. Je stocke tout d&#39;abord la liste de balises title dans un corpus, puis j&#39;applique un ensemble de traitements : suppression de la ponctuation (via une fonction personnalisée), suppression des caractères numériques, suppression des stopwords, changement de la casse (minuscule).</p> <div class=highlight><pre class="highlight r"><code><span class="n">replacePunctuation</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">content_transformer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"[[:punct:]]"</span><span class="p">,</span><span class="s2">" "</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">))})</span><span class="w">

</span><span class="n">corpus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">VCorpus</span><span class="p">(</span><span class="n">VectorSource</span><span class="p">(</span><span class="n">output</span><span class="p">))</span><span class="w">
</span><span class="n">corpus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tm_map</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span><span class="w"> </span><span class="n">replacePunctuation</span><span class="p">)</span><span class="w">
</span><span class="n">corpus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tm_map</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span><span class="w"> </span><span class="n">removeNumbers</span><span class="p">)</span><span class="w">
</span><span class="n">corpus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tm_map</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span><span class="w"> </span><span class="n">removeWords</span><span class="p">,</span><span class="w"> </span><span class="n">stopwords</span><span class="p">(</span><span class="s2">"french"</span><span class="p">))</span><span class="w">
</span><span class="n">corpus</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tm_map</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span><span class="w"> </span><span class="n">content_transformer</span><span class="p">(</span><span class="n">tolower</span><span class="p">))</span><span class="w">
</span></code></pre></div> <h2>Créer la matrice et visualiser les données</h2> <p>Une fois le corpus prêt, je transforme le corpus en &ldquo;Term Document Matrix&rdquo; : il s&#39;agit d&#39;une matrice présentant la fréquence des mots apparaissant dans le corpus de documents. Pour donner du sens à l&#39;analyse, je transforme chaque suite de caractères en séquence de 2 mots (bi-grammes), grâce à la fonction <code>NGramTokenizer</code> :</p> <div class=highlight><pre class="highlight r"><code><span class="n">BigramTokenizer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">NGramTokenizer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">Weka_control</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">tdm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">TermDocumentMatrix</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">tokenize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigramTokenizer</span><span class="p">))</span><span class="w">
</span></code></pre></div> <p>Je transforme la TDM en matrice &ldquo;classique&rdquo;, puis je génère la visualisation :</p> <div class=highlight><pre class="highlight r"><code><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">tdm</span><span class="p">)</span><span class="w">
</span><span class="n">corrplot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">is.corr</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div> <p><img src="/images/posts/tdm.png" title="Term Document Matrix" alt=SSL /></p> <p>Il y aurait quelques optimisations à faire (suppression des accents, lemmatisation ou racinisation des mots, augmentation de la taille du corpus) mais le résultat est déjà très intéressant. On peut voir, par exemple, que dans 9 résultats sur 10 l&#39;expression &ldquo;consultant seo&rdquo; est présente dans la balise title et que les mots-clés &ldquo;expert seo&rdquo; et &ldquo;expert référencement&rdquo; reviennent également fréquemment.</p> <p>Voilà, à bientôt pour un nouvel article sur R !</p> <div id=disqus_thread></div> <script>
//<![CDATA[
                  var disqus_shortname = 'blogantoinebrisset';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script> <noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript> <a href='http://disqus.com' class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a> </article></div></div><footer class=footer><div role=content-info><ul class=footer__content><li class=footer__content__item><i class="fa fa-home"></i> Marquette-lez-Lille</li><li class=footer__content__item><i class="fa fa-phone"></i> 06 12 71 82 78</li><li class=footer__content__item><i class="fa fa-envelope"></i> <a href="#email-protection-pbagnpg@nagbvar-oevffrg.pbz">contact@antoine-brisset.com</a> </li></ul><ul class=footer__content--social><li class=footer__content__item--social><a href="https://twitter.com/abrisset"><i class='fa fa-twitter footer__icon'></i></a></li><li class=footer__content__item--social><a href="https://github.com/ABrisset"><i class='fa fa-github footer__icon'></i></a></li><li class=footer__content__item--social><a href="http://plus.google.com/112811217796192792405?rel=author"><i class='fa fa-google-plus footer__icon'></i></a></li></ul><div class=footer__copyright> &copy; 2019 - <a href="/">Antoine Brisset</a></div></div></footer><script type="text/javascript">!function(){try{var a,b,c,d,g=document.getElementsByTagName("a");for(c=0;g.length-c;c++)try{b=g[c].getAttribute("href"),b&&b.indexOf("#email-protection-")>-1&&b.length>19&&(a="",d=19+b.indexOf("#email-protection-"),b.length>d&&(a=b.substr(18).replace(/[a-zA-Z]/g,function(a){return String.fromCharCode(("Z">=a?90:122)>=(a=a.charCodeAt(0)+13)?a:a-26)})),g[c].setAttribute("href","mailto:"+a))}catch(h){}}catch(h){}}();</script>
</body></html>